$engine_version: 2
$minFxServerVersion: 7290

name: Double Sync Framework
version: 1.0.0
author: Double Sync Team
description: Complete RedM framework - Multi-character, HUD, Inventory, Needs

variables:
  dbHost: localhost
  dbUsername: root
  dbPassword: ""
  dbName: doublesync
  svLicense: changeme
  svMaxClients: 32

tasks:
  - action: download_github
    src: https://github.com/FarrofaDeBacon/DSCore
    ref: main
    dest: ./resources/[ds]/ds-core

  - action: download_github
    src: https://github.com/overextended/oxmysql
    ref: master
    dest: ./resources/[standalone]/oxmysql

  - action: remove_path
    path: ./resources/[ds]/ds-core/.git
    
  - action: remove_path
    path: ./resources/[standalone]/oxmysql/.git

  - action: write_file
    path: ./server.cfg
    file: |
        sv_hostname "Double Sync RP"
        sv_maxclients {{svMaxClients}}
        sets sv_projectName "Double Sync RP"
        sets sv_projectDesc "RedM Roleplay Server"
        sv_licenseKey "{{svLicense}}"
        set mysql_connection_string "mysql://{{dbUsername}}:{{dbPassword}}@{{dbHost}}/{{dbName}}?charset=utf8mb4"
        setr ox:locale "en"
        ensure oxmysql
        ensure ds-core

  - action: query_database
    query: CREATE DATABASE IF NOT EXISTS {{dbName}} CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

  - action: connect_database
    database: "{{dbName}}"

  - action: query_database
    query: |
        CREATE TABLE IF NOT EXISTS ds_players (
            id INT AUTO_INCREMENT PRIMARY KEY,
            citizenid VARCHAR(50) NOT NULL UNIQUE,
            license VARCHAR(100) NOT NULL,
            name VARCHAR(100),
            charinfo JSON DEFAULT NULL,
            money JSON DEFAULT NULL,
            job JSON DEFAULT NULL,
            gang JSON DEFAULT NULL,
            position JSON DEFAULT NULL,
            metadata JSON DEFAULT NULL,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4

  - action: query_database
    query: |
        CREATE TABLE IF NOT EXISTS ds_logs (
            id INT AUTO_INCREMENT PRIMARY KEY,
            type VARCHAR(50) NOT NULL,
            source INT,
            citizenid VARCHAR(50),
            message TEXT,
            data JSON,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4

  - action: query_database
    query: |
        CREATE TABLE IF NOT EXISTS ds_bans (
            id INT AUTO_INCREMENT PRIMARY KEY,
            license VARCHAR(100) NOT NULL,
            discord VARCHAR(50),
            reason TEXT,
            banned_by VARCHAR(100),
            expire_at TIMESTAMP NULL,
            permanent BOOLEAN DEFAULT FALSE,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4

  - action: query_database
    query: |
        CREATE TABLE IF NOT EXISTS ds_inventory (
            id INT AUTO_INCREMENT PRIMARY KEY,
            citizenid VARCHAR(50) NOT NULL,
            items JSON DEFAULT NULL,
            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4

  - action: waste_time
    seconds: 2

  - action: notify
    message: Double Sync Framework instalado! Configure sua license key no server.cfg
